!function(){var t={VERSION:"1.2",Map:{},Utils:{},Layers:{},Controls:{},Widget:{}};"undefined"!=typeof window&&(window.EMap=t)}(),function(){EMap.Utils=function(){return{dataToGeoJson:function(t,e){var i={type:"FeatureCollection",features:[]};return $.each(t,function(t,n){var a={geometry:{type:e,coordinates:n.coordinates},type:"Feature",properties:{}};$.each(n,function(t,e){"coordinates"!==t&&(a.properties[t]=e)}),i.features.push(a)}),i},fomatterColor:function(t){var e=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/,i=t.toLowerCase();if(t.indexOf("rgba")>-1)return t;if(t.indexOf("rgb")>-1){for(var n=t.replace(/(?:||rgb|RGB)*/g,"").replace(/\(/g,"").replace(/\)/g,"").split(","),a="",o=0;o<n.length;o++)a=a+n[o]+",";return"rgba("+a+"1)"}if(e.test(i)){if(4===i.length){for(var r="#",o=1;o<4;o+=1)r+=i.slice(o,o+1).concat(i.slice(o,o+1));i=r}for(var s=[],o=1;o<7;o+=2)s.push(parseInt("0x"+i.slice(o,o+2)));return"rgba("+s.join(",")+",1)"}}}}(),EMap.Utils.PolygonType="Polygon",EMap.Utils.LineStringType="LineString",EMap.Utils.PointType="Point"}(),function(){function t(t,e){this.startPoint=t,this.endPoint=e}"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):(function(){return this||(0,eval)("this")}()).arrowHead=t,t.prototype.draw=function(t,e,i,n){var a=Math.atan((this.endPoint.y-this.startPoint.y)/(this.endPoint.x-this.startPoint.x));a+=(this.endPoint.x>this.startPoint.x?90:-90)*Math.PI/180,t.save(),t.fillStyle=n,t.beginPath(),t.translate(this.endPoint.x,this.endPoint.y),t.rotate(a),t.moveTo(0,0),t.lineTo(i/2,e),t.lineTo(-i/2,e),t.fill(),t.closePath(),t.restore()}}(),function(){function t(t,e,i,n){this.k=0,this.k_step=.005,this.angle=45,this.startPoint=t,this.endPoint=e,this.data=n,this.style=i,this.lineStyle=i.pathStyle||"straight",this.controlPoint=this.getBezierControlPoint(this.lineStyle,i.curveness||.2),"function"==typeof i.lineColor?this.lineColor=i.lineColor.call(null,n):this.lineColor=i.lineColor,this.lineColor=EMap.Utils.fomatterColor(this.lineColor),this._points=this.getBezierPathPoints()}"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):(function(){return this||(0,eval)("this")}()).QuadraticBezier=t,t.prototype={createBezierLine:function(t){t.strokeStyle=this.lineColor,t.beginPath(),t.moveTo(this.startPoint.x,this.startPoint.y),t.quadraticCurveTo(this.controlPoint.x,this.controlPoint.y,this.endPoint.x,this.endPoint.y),t.stroke()},draw:function(t){var e=this.getBezierPathPoint(),i=this.getBezierPathPoint(this.k),n=Math.atan((i.y-e.y)/(i.x-e.x));if(n+=(i.x>e.x?0:-180)*Math.PI/180,t.save(),t.beginPath(),void 0!==this.style.image&&null!==this.style.image)t.font=this.style.image.font,t.lineWidth=1,t.translate(e.x,e.y),t.rotate(n),t.strokeStyle=this.style.image.color,t.strokeText(this.style.image.pathImageFont,-4,4),t.fillText(this.style.image.pathImageFont,-4,4);else{t.arc(e.x,e.y,3*this.style.weight/4,0,2*Math.PI,!1);var a=t.createRadialGradient(e.x,e.y,0,e.x,e.y,this.style.weight);a.addColorStop(0,"rgba(255,255,255,1)"),a.addColorStop(1,this.style.wavesColor),t.fillStyle=a,t.fill()}t.closePath(),t.restore()},update:function(){if(this.k>1)this.k=0,this.k_step=.005;else{this.getBezierPathPoint(this.k);this.k>.9&&(this.k_step=.002),this.k=this.k+this.k_step}},getBounds:function(){},getBezierPathPoints:function(){for(var t=[],e=0;e<1;e+=this.k_step){var i=this.getBezierPathPoint(e);t.push(i)}return t},getBezierControlPoint:function(t,e){if("curve"===t){var i=[(this.startPoint.x+this.endPoint.x)/2-(this.startPoint.y-this.endPoint.y)*e,(this.startPoint.y+this.endPoint.y)/2-(this.endPoint.x-this.startPoint.x)*e];return{x:i[0],y:i[1]}}return this.endPoint},distance:function(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},getBezierPathPoint:function(t){var e=void 0===t?this.k:t,i=1-e,n=this.startPoint.x,a=this.startPoint.y,o=this.controlPoint.x,r=this.controlPoint.y,s=this.endPoint.x,l=this.endPoint.y,h=i*i*n+2*(1-e)*e*o+e*e*s,c=i*i*a+2*(1-e)*e*r+e*e*l;return void 0===t&&this.update(),{x:h,y:c}}}}(),function(){function t(t){this.style=t,this.style.color=EMap.Utils.fomatterColor(t.color),this.init_opacity=1,this.r=t.r,this.opacity=1,this.r_step=.1,this.opacity_step=.96,this.finised=!0}"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):(function(){return this||(0,eval)("this")}()).circle_wave=t,t.prototype={reset:function(){this.opacity=this.init_opacity,this.r=this.style.r,this.finised=!0},draw:function(t,e){if(e&&(this.finised=!1),0==this.finised){t.beginPath(),t.arc(this.style.x,this.style.y,this.r,0,2*Math.PI,!1);var i=this.style.color.split(",");i[3]=this.opacity,t.strokeStyle=i.join(","),t.stroke(),this.update()}},update:function(){this.opacity>.033?(this.r+=this.r_step,this.r>10&&(this.opacity*=this.opacity_step)):this.reset()},createCircle:function(t){t.fillStyle=this.style.color,t.beginPath(),t.arc(this.style.x,this.style.y,this.style.r,0,2*Math.PI),t.fill(),t.closePath()},getBounds:function(){var t=this.style.x-this.style.r,e=this.style.y-this.style.r,i=2*this.style.r;return{x:t,y:e,w:i,h:i}}}}(),function(){EMap.Controls=function(){var t=function(t){return t=t||{},L.control.baseMapswitchControl(t)},e=function(t){return L.control.sideBySide(t.leftLayer,t.rightLayer)},i=function(t,e){e=e||{};var i=L.control({position:e.position||"bottomright"}),n=e.className||"legend";return i.onAdd=function(e){return this.div=L.DomUtil.create("div",n),this.update(t),this.div},i.update=function(t){var e=this;this.div.innerHTML="",$.each(t,function(t,i){e.div.innerHTML+='<i style="background:'+i+'"></i>'+t+"<br>"})},i},n=function(t){return t=t||{},L.control.layers({},{},{position:t.position||"topright",collapsed:t.collapsed||!0})};return L.Control.LayerInfo=L.Control.extend({options:{position:"bottomleft"},initialize:function(t){L.setOptions(this,t)},onAdd:function(t){return this._div=L.DomUtil.create("div","layerInfo"),this.updateContent(),this._div},updateContent:function(t){this._div.innerHTML=this.options.updateContent.call(this,t)}}),L.control.layerInfo=function(t){return new L.Control.LayerInfo(t)},{legendControl:i,layerControl:n,baseMapSwitchControl:t,layerInfoControl:L.control.layerInfo,leafletSliderCompare:e}}()}(),function(){var t=[{mapName:"天地图矢量",cssmapImg:"baseMapSwitch-vector",layerType:"tdt",layerOption:{crs_name:"EPSG4490",layer:"vec"}},{mapName:"天地图影像",layerType:"tdt",cssmapImg:"baseMapSwitch-image",layerOption:{crs_name:"EPSG4490",layer:"img"}}],e={crs:L.CRS.EPSG4490,maxZoom:18,minZoom:4,zoom:4,center:[22.707966631294234,113.4654563919944],attributionControl:!1,baseMapSwitchControl:{configs:t,show:!0},positionControl:!0,scaleControl:!0};EMap.Map=function(t,i){var n={};n=i?$.extend(!0,{},e,i):e;var a=new L.Map(t,n);if(n.baseMapSwitchControl){var o=EMap.Controls.baseMapSwitchControl({configs:n.baseMapSwitchControl.configs});o.addTo(a),!1===n.baseMapSwitchControl.show&&o.hide(),a.baseMapSwitchControl=o}return n.scaleControl&&L.control.scale({imperial:!1}).addTo(a),a}}(),function(){EMap.Layers=L.Layer.extend({options:{},initialize:function(t){this._layers={},L.setOptions(this,t)},onAdd:function(t){},onRemove:function(){}})}(),function(){EMap.Layers.CanvasLayer=EMap.Layers.extend({includes:[L.Evented],defalut_options:{opacity:1,zIndex:300},initialize:function(t){this.options=L.Util.extend({},this.defalut_options,t),EMap.Layers.prototype.initialize.call(this,this.options),this.currentAnimationFrame=-1,this.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)},this.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||function(t){clearTimeout(t)}},_createCanvas:function(t){var e=document.createElement("canvas");return e.width=t.x,e.height=t.y,e.setAttribute("class","leaflet-zoom-animated"),e},onAdd:function(t){this._map=t,t.on({moveend:this._reset},this),t.on({resize:this._onLayerDidResize},this),this._reset()},draw:function(){return this._reset()},onRemove:function(t){L.DomUtil.remove(this.container),t.off({moveend:this._reset},this),t.off({resize:this._onLayerDidResize},this),this._map=null,this.container=null},addTo:function(t){return t.addLayer(this),this},setOpacity:function(t){return this.container.style.opacity=t,this},setZIndex:function(t){return this.container&&(this.container.style.zIndex=t),this},_onLayerDidResize:function(t){if(this.container){this.container.childNodes.forEach(function(e){e.width=t.newSize.x,e.height=t.newSize.y})}},_reset:function(t,e){var i=this._map.getBounds(),n=this._map.latLngToLayerPoint(i.getNorthWest());L.DomUtil.setPosition(this.container,n),this._render()},_fillCanvas:function(t,e){var i=t.globalCompositeOperation;t.globalCompositeOperation="destination-out";var e=e||30;t.fillStyle="rgba(0, 0, 0, "+1/e+")",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.globalCompositeOperation=i},_render:function(){this.currentAnimationFrame>=0&&this.cancelAnimationFrame.call(window,this.currentAnimationFrame),this.render()},render:function(){throw new Error("render function should be implemented")}})}(),function(){EMap.Layers.FeatureLayer=EMap.Layers.extend({options:{isLabelShow:!1},initialize:function(t){t=t||{},L.Util.setOptions(this,t),EMap.Layers.prototype.initialize.call(this,this.options),this.featureType=""},_getLayerStyle:function(){var t;switch(this.featureType){case EMap.Utils.PointType:t={radius:5,fillColor:"#ff7800",color:"#999",weight:.5,opacity:.5,fillOpacity:.8};break;case EMap.Utils.PolygonType:t={weight:1,color:"#999",opacity:1,fillColor:"#B0DE5C",fillOpacity:.6};break;case EMap.Utils.LineStringType:t={weight:3,color:"rgb(51, 136, 255)",opacity:1}}return t},_featureLayer:function(t,e){var i,n;e=e||{};var a=t;if(!L.Util.isArray(a)||void 0===a||null===a)return console.log("你的数据为空，或者不是数组格式"),null;i=EMap.Utils.dataToGeoJson(a,this.featureType);var o=this._getLayerStyle(this.featureType);n=e.style?"function"==typeof e.style?e.style:$.extend(!0,{},o,e.style):o;var r={pointToLayer:function(t,i){if("function"==typeof e.style){var a=t.properties;n=e.style(a)}return L.circleMarker(i,n)},onEachFeature:function(t,i){t.properties.name&&i.bindTooltip(t.properties.name,{noHide:e.isLabelShow}),t.properties.popupContent&&i.bindTooltip(t.properties.popupContent)}};return this.featureType!==EMap.Utils.PointType&&(r.style=n),L.geoJson(i,r)}})}(),function(){EMap.Layers.ClusterLayer=EMap.Layers.extend({initialize:function(t){L.setOptions(this,t)},getClusterLayer:function(t){var e,i,n,a=t,o={radius:5,fillColor:"#ff7800",color:"#999",weight:1,opacity:1,fillOpacity:.8},r=this.options||{};if(!L.Util.isArray(a)||void 0===a||null===a)return console.log("你的数据为空，或者不是数组格式"),null;n=L.markerClusterGroup({showCoverageOnHover:!1,spiderfyOnMaxZoom:!0,disableClusteringAtZoom:15,animate:!0}),e=EMap.Utils.dataToGeoJson(a,"Point"),i=r.style?$.extend(!0,{},o,r.style):o;i.fillColor&&i.fillColor;var s=e.features;return $.each(s,function(t,e){var a=L.extend([],e.geometry.coordinates).reverse(),o=L.circleMarker(a,i);e.properties.name&&o.bindTooltip(e.properties.name),e.properties.popupContent&&o.bindPopup(e.properties.popupContent),n.addLayer(o)}),n}}),EMap.Layers.clusterLayer=function(t,e){return new EMap.Layers.ClusterLayer(e).getClusterLayer(t)}}(),function(){EMap.Layers.HeatLayer=EMap.Layers.extend({options:{radius:15,blur:15,minOpacity:.5},initialize:function(t){L.setOptions(this,t)},getHeatLayer:function(t){var e=t,i=this.options||{};if(!L.Util.isArray(e)||void 0===e||null===e)return console.log("你的数据为空，或者不是数组格式"),null;var n=EMap.Utils.dataToGeoJson(e,"Point"),a=1,o=n.features.map(function(t){var e=L.extend([],t.geometry.coordinates),i=e.reverse();return t.properties.intensity&&(t.properties.intensity>a&&(a=t.properties.intensity),i.push(t.properties.intensity)),i});return i.max=a,L.heatLayer(o,i)}}),EMap.Layers.heatLayer=function(t,e){return new EMap.Layers.HeatLayer(e).getHeatLayer(t)}}(),function(){EMap.Layers.EchartMarkerLayer=EMap.Layers.extend({options:{style:{chartWidth:130,chartHeight:130},zoomInFactor:1.2,zoomOutFactor:.9},initialize:function(t,e){L.setOptions(this,e),this.dataList=t},onAdd:function(t){this._map=t,this.chartLayer=L.featureGroup(),this.arr_charts=[],t.addLayer(this.chartLayer);var e=this._computerChartWH(t);this._createLayer(e.width,e.height);var i=this.arr_charts[0].getOption().legend[0].data,n=this.arr_charts[0].getOption().color,a={};$.each(i,function(t,e){a[e]=n[t]}),this.legendControl=EMap.Controls.legendControl(a),t.addControl(this.legendControl),t.on({zoomend:this._reset},this)},onRemove:function(t){t.removeLayer(this.chartLayer),t.removeControl(this.legendControl),t.off({zoomend:this._reset},this),this.arr_charts=[],this.chartLayer=null},_reset:function(t){var e=this._map;this.chartLayer.clearLayers(),this.arr_charts.forEach(function(t){t.dispose()});var i=this._computerChartWH(e);this._createLayer(i.width,i.height)},_createEchartMarker:function(t,e,i){var n,a;n=void 0==e?this.options.style.chartWidth:e,a=void 0==i?this.options.style.chartHeight:i;var o="echartMarker_"+t.id,r=t.coordinates,s=t.chartOptions,l=L.divIcon({className:"leaflet-echart-icon",iconSize:[n,a],html:'<div id="'+o+'" style="width: '+n+"px; height: "+a+'px; position: relative; background-color: transparent;"></div>',iconAnchor:[n/2,a/2]}),h=(L.marker([r[1],r[0]],{icon:l}).addTo(this.chartLayer),echarts.init(document.getElementById(o)));h.setOption(s),this.arr_charts.push(h)},getEcharts:function(){return this.arr_charts},_computerChartWH:function(t){var e,i,n=t.options.zoom,a=t.getZoom();return a<n?(e=this.options.style.chartWidth*Math.pow(this.options.zoomOutFactor,n-a),i=this.options.style.chartHeight*Math.pow(this.options.zoomOutFactor,n-a)):a>n?(e=this.options.style.chartWidth*Math.pow(this.options.zoomInFactor,a-n),i=this.options.style.chartHeight*Math.pow(this.options.zoomInFactor,a-n)):(e=this.options.style.chartWidth,i=this.options.style.chartHeight),{width:e,height:i}},_createLayer:function(t,e){var i=this;$.each(this.dataList,function(n,a){i._createEchartMarker(a,t,e)})}}),EMap.Layers.echartMarkerLayer=function(t,e){return new EMap.Layers.EchartMarkerLayer(t,e)}}(),function(){EMap.Layers.ShapeFileLayer=EMap.Layers.extend({includes:[L.Evented],options:{style:{pointStyle:{text_style:{font_color:"black"},icon_style:{fillColor:"blue"},label:{showZoom:15},featureType:EMap.Utils.PointType},polylineStyle:{weight:2,color:"#666",dashArray:"",fillOpacity:.7},polygonStyle:{weight:1,color:"red",dashArray:"",fillOpacity:.3}},labelColumn:"name"},initialize:function(t,e){this.options=$.extend(!0,{},this.options,e),EMap.Layers.CanvasLayer.prototype.initialize.call(this,this.options),this.readFile(t)},readFile:function(t){var e=t[0];this._loadFile(e,function(t,i,n){t?console.log("读取文件出错"):n._readFileContent(e.name,i)})},_loadFile:function(t,e){var i=this,n=new FileReader;MapShaper.isBinaryFile(t.name)?n.readAsArrayBuffer(t):n.readAsText(t,"UTF-8"),n.onload=function(t){e(null,n.result,i)}},_readFileContent:function(t,e){var i,n,a=MapShaper.guessInputType(t,e),o={},i=this.dataset;if("dbf"==a)if(i){n=i.layers[0],n.data=new MapShaper.ShapefileTable(e,"utf8");var r=i.layers[0].geometry_type;"point"==r&&this._reCreatePointLayer(i),n.shapes&&n.data.size()!=n.shapes.length&&MapShaper.stop(".dbf 与对应的 .shp 文件中记录数不一样。")}else MapShaper.stop("未找到对应的shape文件，请先导入shape文件。");else"prj"==a||this._importFileContent(a,t,e,o)},_importFileContent:function(t,e,i,n){var a=i.byteLength||i.length,o=a>4e7,r=0;n.files=[e],o&&(r=35);var s=this;setTimeout(function(){var t=MapShaper.importFileContent(i,e,n);s.dataset=t,s.fire("onfinished")},r)},onAdd:function(t){var e=this.dataset;if(e){var i=this._createLayers(e);e.layers[0].leafletLayer=i,this.map=t,t.addLayer(i)}},_reCreatePointLayer:function(t){t.layers[0].leafletLayer&&this.map.removeLayer(t.layers[0].leafletLayer);var e=t.layers[0].shapes,i=this._createPointsLayer(e,this);t.layers[0].leafletLayer=i,this.map.addLayer(i)},_createLayers:function(t){var e,i=this,n=t.layers[0].geometry_type,a=MapShaper.hitShape(t.arcs,t.layers[0].shapes);if("point"===n){var o=t.layers[0].shapes;e=this._createPointsLayer(o,i)}else if("polygon"===n){var r=t.arcs.toArray();e=this._createPolygonsLayer(r,a,i)}else if("polyline"===n){var s=t.arcs.toArray();e=this._createPolylinesLayer(s,a,i)}return e},setZIndex:function(t){var e=dataset.layers[0].leafletLayer;e&&e.setZIndex(t)},_createPolylinesLayer:function(t,e,i){var n=L.featureGroup(),a=L.canvas({padding:.5}),o=$.extend(!0,{},this.options.style.polylineStyle,{renderer:a});return t.forEach(function(t,a){t=L.GeoJSON.coordsToLatLngs(t);var r=L.polyline(t,o).addTo(n);i.hasEventListeners("click")&&r.on("click",function(t){var n=(t.target,t.latlng),a=e.polylineHit(n.lng,n.lat),o=i.dataset.layers[0].data;if(o){var r=o.getRecordAt(a[0]);i.fire("click",{obj:r,event:t,geometry_type:"polyline"})}else console.log("请导入对应的dbf文件。")})}),n},destroy:function(){if(this.dataset){var t=this.dataset;t.layers[0].leafletLayer&&this.map.removeLayer(t.layers[0].leafletLayer)}delete this.dataset,delete t},_createPolygonsLayer:function(t,e,i){var n=L.featureGroup(),a=L.canvas({padding:.5}),o=$.extend(!0,{},this.options.style.polygonStyle,{renderer:a});return t.forEach(function(t,a){t=L.GeoJSON.coordsToLatLngs(t);var r=L.polygon([t],o).addTo(n);i.hasEventListeners("click")&&r.on("click",function(t){var n=(t.target,t.latlng),a=e.polygonHit(n.lng,n.lat),o=i.dataset.layers[0].data;if(o){var r=o.getRecordAt(a[0]);i.fire("click",{obj:r,event:t,geometry_type:"polygon"})}else console.log("请导入对应的dbf文件。")})}),n},_createPointsLayer:function(t,e){var i,n=[],a=e.dataset.layers[0].data;t.forEach(function(t,o){var r=o;a&&(i=a.getRecordAt(o),r=i[e.options.labelColumn]),data={name:r,properties:i,coordinates:t[0]},n.push(data)});var o=EMap.Layers.CanvasLayer.markerLabel(n,this.options.style.pointStyle);return e.hasEventListeners("click")&&o.on("click",function(t){var i=t.obj;e.fire("click",{obj:i,event:t,geometry_type:"point"})}),o},onRemove:function(t){if(this.dataset){var e=this.dataset;e.layers[0].leafletLayer&&t.removeLayer(e.layers[0].leafletLayer)}}}),EMap.Layers.shapeFileLayer=function(t,e){return new EMap.Layers.ShapeFileLayer(t,e)}}(),function(){function e(t,e){this._map=t,this._mapOffset=[0,0],this._api=e,this._projection=L.Projection.Mercator}function i(t,e,i,n){var a=i.leafletModel,o=i.seriesModel,r=a?a.coordinateSystem:o?o.coordinateSystem||(o.getReferringComponents("leaflet")[0]||{}).coordinateSystem:null;return r===this?r[t](n):null}e.dimensions=e.prototype.dimensions=["lng","lat"],e.prototype.getLeaflet=function(){return this._map},e.prototype.dataToPoint=function(t){var e=new L.LatLng(t[1],t[0]),i=this._map.latLngToContainerPoint(e),n=this._mapOffset;return[i.x-n[0],i.y-n[1]]},e.prototype.pointToData=function(t){var e=this._mapOffset,i=this._map.layerPointToLatLng({x:t[0]+e[0],y:t[1]+e[1]});return[i.lng,i.lat]},"object"==typeof echarts&&(e.prototype.convertToPixel=echarts.util.curry(i,"dataToPoint"),e.prototype.convertFromPixel=echarts.util.curry(i,"pointToData")),e.prototype.getViewRect=function(){var t=this._api;return new echarts.util.BoundingRect(0,0,t.getWidth(),t.getHeight())},e.create=function(t,i){var n=null,a=[];return t.eachComponent("leaflet",function(t){n=new e(echarts.leafletMap,i),a.push(n),t.coordinateSystem=n}),t.eachSeries(function(t){"leaflet"===t.get("coordinateSystem")&&(t.coordinateSystem=n)}),a},EMap.Layers.CanvasLayer.EchartMap=EMap.Layers.CanvasLayer.extend({container:null,_chart:null,_echartsOption:null,initialize:function(t){if(void 0==t.chartOptions)throw new Error("必须配置Echart options!");this._echartsOption=t.chartOptions,EMap.Layers.CanvasLayer.prototype.initialize.call(this,this.options),echarts.registerCoordinateSystem("leaflet",e),echarts.extendComponentModel({type:"leaflet"})},render:function(){this._initECharts(),this._setEchartOption(this._echartsOption)},_geoCoord2Pixel:function(e){var i=new t.latLng(e[1],e[0]),n=this._map.latLngToContainerPoint(i);return[n.x,n.y]},_pixel2GeoCoord:function(e){var i=this._map.containerPointToLatLng(t.point(e[0],e[1]));return[i.lng,i.lat]},_setEchartOption:function(t,e){this._chart.setOption(t)},_initECharts:function(){this._chart&&this._chart.dispose(),this._chart=echarts.init(this.container)},onAdd:function(t){var e=t.getSize();this.container=t.createPane("echartPane"),this.container.style.width=e.x+"px",this.container.style.height=e.y+"px",this.setZIndex(this.options.zIndex),echarts.leafletMap=t,EMap.Layers.CanvasLayer.prototype.onAdd.call(this,t)},onRemove:function(t){this._chart.dispose(),echarts.leafletMap=null,delete echarts.leafletMap,EMap.Layers.CanvasLayer.prototype.onRemove.call(this,t)}}),EMap.Layers.CanvasLayer.echartMap=function(t){return new EMap.Layers.CanvasLayer.EchartMap(t)}}(),function(){EMap.Layers.CanvasLayer.MarkerLabel=EMap.Layers.CanvasLayer.extend({options:{text_style:{font_color:"red",font_borderColor:"#ffffff",font_borderWidth:"3",font_style:"normal",font_variant:"normal",font_weight:"normal",font_size:"12px",font_family:"Microsoft Yahei"},icon_style:{max_num:1e4,url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAMAAADzapwJAAABv1BMVEUAAADVKyvbJCS/QCDVQCvbNzfMRDPRRjrTQzfWPTPYRTHZQjnbQDfcPjXaQznbRjjaRDfbRTnbRDjcQzjZRjjaRDrbRDnbRjncRjraRTjcRDnbRDncRTncRTjbRTncRTnbRTnbRTncRTnbRTnbRjncRTrcRTnbRTrbRTnbRTnbRTncRjrbRjnbRjrbRTncRTnqlY7qlo/sm5TsnJftnpftnpjsopvto5zto53wsavxs63xtK7xtLDxtbH0zMn1zsz10M375+X76+n77Ov87ev87u387+798vH98vL98/P++Pf++vr++/r+/Pz//v3cRjrcSDzdST3dSj7dSj/dTEDdTULeTkLeT0TeUEXeUUbeUkbeUkfeU0jfVEnhXlPhYVfhYlfiZFriaF7jamHjbWTkbmTkb2bkcGfkcWjlc2rldGvldWzngXnngnrohHzpiYLpioPpjITqjobqj4fqj4jqkInqkYrsnZftn5nwsq3xtK/yvLjzvbn0xcH1y8f1y8j1zMn2zcr2zsr2z8z20c720s/309D429j54d/64uD64+H64+L65OL65eP65uT76+n87ez99fT99vb//v7///+4ukhLAAAAT3RSTlMABgcIDA4PFhcZGhscHUxNU1VWV19hYmNmaIqOkJGipqmqrbKztba5v8DBwsXGyMrf3+Hh4eLj4+Pn5+fo6O/w8Pf5+fn5+vv7+/z9/f7+kgHTrgAAAVhJREFUGBlNwYc7QlEYB+CvKHvvEVnXuPYoKyJl+0nIyMjee4+MIivz/MHOc9wH70s/tPE6qaJC0iVo6Y86uajWbB0YsJrr5OQgUkTojbabg2n7yOzela0+J5KEKKn5ZQ2K1WdTYRRxar3pbhK/JnymHDURpRkDE/hn5MGYQqSVu5YgnBxDWLCVaCmm6hqC4/3NDsFTl0DpLdsQthjbgrBn1lFumxvAzqn3g7EP39kugFmbRHKPE4CHKTwARvvLqaxvGIDjkgmXDgBD/eWUb5kBZ39i3JMd3LRVovSWI3CDn4z7HAS3b86k6MpbcHPs6+L8i82Du66Np+AiywqADf8ysOTfBLDYUawhSjQEpvDP+KMxiYhU2Q33Lvxy3TVkqYkLLWh8XYdiLdAkhZAQlm3o9B25x5zuQ2+3QR9OClWqXN3a3ttraa2R01T0RxObkVdamp8RpyHhGy8KgC4Bj+iFAAAAAElFTkSuQmCC",width:8,height:8,fillColor:"red"},label:{showZoom:13}},initialize:function(t,e){e=e||{},this.options=$.extend(!0,{},this.options,e),EMap.Layers.CanvasLayer.prototype.initialize.call(this,this.options),this.dataList=t},render:function(){var t=(this.options.featureType,this.options.text_style),e=this.dataList,i=this.canvas,n=i.getContext("2d");this.rtree=RTree();n.clearRect(0,0,i.width,i.height),n.beginPath(),n.font=t.font_style+" "+t.font_variant+" "+t.font_weight+" "+t.font_size+" "+t.font_family,n.strokeStyle=t.font_borderColor,n.lineWidth=2*t.font_borderWidth,n.fillStyle=t.font_color;for(var a=0;a<e.length;a++){var o=e[a];o.txtWidth||(txtWidth=n.measureText(o.name).width,o.txtWidth=txtWidth),this._drawMarker(n,o)}},addMarker:function(t){var e=this.canvas,i=e.getContext("2d");this.dataList.push(t),this._drawMarker(i,t)},_drawMarker:function(t,e){var i=this.dataList.length,n=this._map.getZoom(),a=this._computerLocate(e);if(null!=a){var o={x:a.x-this.options.icon_style.width/2,y:a.y-this.options.icon_style.height/2};if(n>=this.options.label.showZoom){t.fillStyle=this.options.text_style.font_color,t.strokeText(e.name,a.x-e.txtWidth/2,a.y+20),t.fillText(e.name,a.x-e.txtWidth/2,a.y+20);var r=a.x-(e.txtWidth+8)/2,s=a.y+8;this.rtree.insert({x:r,y:s,w:e.txtWidth+8,h:16},e)}if(i<this.options.icon_style.max_num)if(e.canvas_img)t.drawImage(e.canvas_img,o.x,o.y,this.options.icon_style.width,this.options.icon_style.height);else{var l=this;e.canvas_img=new Image,e.canvas_img.src=this.options.icon_style.url,e.canvas_img.onload=function(){t.drawImage(e.canvas_img,o.x,o.y,l.options.icon_style.width,l.options.icon_style.height)}}else t.fillStyle=this.options.icon_style.fillColor,t.fillRect(o.x,o.y,4,4)}},_computerLocate:function(t){var e,i=this.options.featureType;if(i===EMap.Utils.LineStringType){var n=turf.lineString(t.coordinates);e=turf.pointOnSurface(n)}else if(i===EMap.Utils.PolygonType){var a=turf.polygon(t.coordinates);e=turf.pointOnSurface(a)}else e=turf.point(t.coordinates);var o=new L.LatLng(e.geometry.coordinates[1],e.geometry.coordinates[0]);return e=this._map.getBounds().contains(o)?this._map.latLngToContainerPoint(o):null},_onMouseClick:function(t){if(null!=this.rtree){var e=[t.clientX,t.clientY],i=this.rtree.search({x:e[0],y:e[1],w:0,h:0});if(0!==i.length){var n=this._map.containerPointToLatLng(e);"click"===t.type?this.fire("click",{obj:i,latlng:n}):this.canvas.style.cursor="pointer"}else this.canvas.style.cursor=""}},onAdd:function(t){var e=t.getSize();this.container=t.createPane("canvasLabel"),this.setZIndex(this.options.zIndex),this.canvas=this._createCanvas(e),this.container.appendChild(this.canvas),EMap.Layers.CanvasLayer.prototype.onAdd.call(this,t),L.DomEvent.addListener(t.getContainer(),"click",this._onMouseClick,this),L.DomEvent.addListener(t.getContainer(),"mousemove",this._onMouseClick,this)},onRemove:function(t){L.DomEvent.removeListener(t.getContainer(),"click",this._onMouseClick,this),L.DomEvent.removeListener(t.getContainer(),"mousemove",this._onMouseClick,this),EMap.Layers.CanvasLayer.prototype.onRemove.call(this,t),this.rtree=null}}),EMap.Layers.CanvasLayer.markerLabel=function(t,e){return new EMap.Layers.CanvasLayer.MarkerLabel(t,e)}}(),function(){EMap.Layers.CanvasLayer.WaveCircle=EMap.Layers.CanvasLayer.extend({options:{style:{fillColor:"rgba(255,43,69,1)",strokeColor:"rgba(255,43,69,1)",radius:6}},initialize:function(t,e){e=e||{},"function"==typeof e.style?this.options=e:this.options=$.extend(!0,{},this.options,e),EMap.Layers.CanvasLayer.prototype.initialize.call(this,this.options),this.dataList=t},render:function(){var t,e=this,i=[],n=this.dataList,a=this.canvas.getContext("2d");this.rtree=RTree(),a.clearRect(0,0,this.canvas.width,this.canvas.height),a.shadowOffsetX=1,a.shadowOffsetY=1,a.shadowBlur=5,a.shadowColor="rgba(0,0,0,0.1)";for(var o=0;o<n.length;o++){var r=new L.LatLng(n[o].coordinates[1],n[o].coordinates[0]),s=this._map.latLngToContainerPoint(r);t="function"==typeof this.options.style?this.options.style(n[o]):this.options.style;var l={x:s.x,y:s.y,r:t.radius,color:t.fillColor};i[o]=new circle_wave(l),this.rtree.insert(i[o].getBounds(),n[o])}e._wave(a,i)},_wave:function(t,e){var n=this;for(this._fillCanvas(t),i=0;i<e.length;i++){var a=e[i];a.createCircle(t),a.draw(t,!0)}this.currentAnimationFrame=requestAnimationFrame(function(){n._wave(t,e)})},_onMouseMove:function(t){var e=[t.clientX-this._map._container.offsetLeft,t.clientY-this._map._container.offsetTop];if(null!=this.rtree){0!==this.rtree.search({x:e[0],y:e[1],w:0,h:0}).length?this.canvas.style.cursor="pointer":this.canvas.style.cursor=""}},_onMouseClick:function(t){var e=[t.clientX-this._map._container.offsetLeft,t.clientY-this._map._container.offsetTop],i=this.rtree.search({x:e[0],y:e[1],w:0,h:0});if(0!==i.length){L.DomEvent.stopPropagation(t);var n=this._map.containerPointToLatLng(e);this.fire("click",{obj:i,latlng:n})}},onAdd:function(t){var e=t.getSize();this.container=t.createPane("waveCircle"),this.setZIndex(this.options.zIndex),this.canvas=this._createCanvas(e,t),this.container.appendChild(this.canvas),EMap.Layers.CanvasLayer.prototype.onAdd.call(this,t),L.DomEvent.addListener(t.getContainer(),"click",this._onMouseClick,this),L.DomEvent.addListener(t.getContainer(),"mousemove",this._onMouseMove,this)},onRemove:function(t){L.DomEvent.removeListener(t.getContainer(),"click",this._onMouseClick),L.DomEvent.removeListener(t.getContainer(),"mousemove",this._onMouseMove),EMap.Layers.CanvasLayer.prototype.onRemove.call(this,t),this.currentAnimationFrame=-1,this.dataList.length=0,this.rtree=null}}),EMap.Layers.CanvasLayer.waveCircle=function(t,e){return new EMap.Layers.CanvasLayer.WaveCircle(t,e)}}(),function(){EMap.Layers.CanvasLayer.MigrateLayer=EMap.Layers.CanvasLayer.extend({options:{style:{weight:1,lineColor:"rgba(70,190,233,0.8)",pathStyle:"straight",wavesColor:"rgba(0,255,255,1)"}},initialize:function(t,e){e=e||{},this.options=$.extend(!0,{},this.options,e),EMap.Layers.CanvasLayer.prototype.initialize.call(this,this.options),this.dataList=t,this.headOpacity=.2,this.bezierPaths=[]},render:function(){var t=this,e=[],i=this.bezierPaths,n=this.dataList,a=this._renderCanvas,o=a.getContext("2d"),r=this._beziereCanvas.getContext("2d");r.globalAlpha=.9,r.lineCap="round",r.lineWidth=this.options.style.weight,o.clearRect(0,0,a.width,a.height),r.clearRect(0,0,a.width,a.height);for(var s=0;s<n.length;s++){var l=n[s].from_coordinates,h=n[s].to_coordinates,c=new L.LatLng(l[1],l[0]),p=new L.LatLng(h[1],h[0]),y=this._map.latLngToContainerPoint(c),u=this._map.latLngToContainerPoint(p),d={x:y.x,y:y.y},f={x:u.x,y:u.y};i[s]=new QuadraticBezier(d,f,this.options.style,n[s]),e[s]=new circle_wave({x:f.x,y:f.y,r:this.options.style.weight/2,color:this.options.style.wavesColor}),i[s].createBezierLine(r);var v=i[s].getBezierPathPoint(1-i[s].k_step);!0===this.options.style.arrowHead&&new arrowHead(v,f).draw(r,10,10,i[s].lineColor)}t._animationPath(i,e)},_animationPath:function(t,e){var i=this;this.headOpacity=this.headOpacity+.01,this.headOpacity>1&&(this.headOpacity=.2);var n=this._renderCanvas,a=n.getContext("2d");this._fillCanvas(a,this.options.style.trail);for(var o=0;o<t.length;o++){bezierPath=t[o],bezierPath.draw(a);var r=bezierPath.k>1;e[o].draw(a,r)}this.currentAnimationFrame=requestAnimationFrame(function(){i._animationPath(t,e)})},onAdd:function(t){var e=t.getSize();this.container=t.createPane("migrate"),this.setZIndex(this.options.zIndex),this._beziereCanvas=this._createCanvas(e),this._renderCanvas=this._createCanvas(e),this.container.appendChild(this._beziereCanvas),this.container.appendChild(this._renderCanvas),EMap.Layers.CanvasLayer.prototype.onAdd.call(this,t),L.DomEvent.addListener(t.getContainer(),"mousemove",this._onMouseClick,this)},_onMouseClick:function(t){if(!(void 0!=this.lastActiveTime&&(new Date).getTime()-this.lastActiveTime<1e3)){var e=null,i=this._map.mouseEventToContainerPoint(t),n=this._filterBezierPathsByPoint(this._map.containerPointToLatLng(i));if(1==n.length)e=n[0].data;else for(var a=0;a<n.length;a++){var o=n[a]._points;if(this._containsPoint(i,o)){this._map.containerPointToLatLng([i.x,i.y]);e=n[a].data;break}}e?(this._renderCanvas.style.cursor="pointer",this.lastActiveTime=(new Date).getTime(),L.DomEvent.stopPropagation(t),this.fire("mousemove",{obj:e})):this._renderCanvas.style.cursor=""}},_filterBezierPathsByPoint:function(t){var e=this;return this.bezierPaths.filter(function(i,n){var a=e.dataList[n].from_coordinates,o=e.dataList[n].to_coordinates,r=turf.point([t.lng,t.lat]);if("curve"===e.options.style.pathStyle){var s=e._map.containerPointToLatLng([i.controlPoint.x,i.controlPoint.y]),l=turf.polygon([[a,[s.lng,s.lat],o,a]]);if(turf.inside(r,l))return!0}else{var h=turf.lineString([a,o]);if(turf.pointOnLine(h,r))return!0}})},_containsPoint:function(t,e,i){var n,a,o,r=this.options.style.weight/2+3;for(L.Browser.touch&&(r+=10),n=1,o=e.length;n<o;n++)if(a=n-1,L.LineUtil.pointToSegmentDistance(t,e[n],e[a])<=r)return!0;return!1},_reset:function(){EMap.Layers.CanvasLayer.prototype._reset.call(this)},onRemove:function(t){L.DomEvent.removeListener(t.getContainer(),"mousemove",this._onMouseClick),EMap.Layers.CanvasLayer.prototype.onRemove.call(this,t),this.currentAnimationFrame=-1,this.bezierPaths.length=0,this.dataList.length=0}}),EMap.Layers.CanvasLayer.migrateLayer=function(t,e){
return new EMap.Layers.CanvasLayer.MigrateLayer(t,e)}}(),function(){EMap.Layers.FeatureLayer.Point=EMap.Layers.FeatureLayer.extend({initialize:function(t){t=t||{},L.Util.setOptions(this,t),EMap.Layers.FeatureLayer.prototype.initialize.call(this,this.options),this.featureType=EMap.Utils.PointType},getFeatureGroup:function(t){return EMap.Layers.FeatureLayer.prototype._featureLayer.call(this,t,this.options)}}),EMap.Layers.FeatureLayer.point=function(t,e){return new EMap.Layers.FeatureLayer.Point(e).getFeatureGroup(t)}}(),function(){EMap.Layers.FeatureLayer.LineString=EMap.Layers.FeatureLayer.extend({initialize:function(t){t=t||{},L.Util.setOptions(this,t),EMap.Layers.FeatureLayer.prototype.initialize.call(this,this.options),this.featureType=EMap.Utils.LineStringType},getFeatureGroup:function(t){return EMap.Layers.FeatureLayer.prototype._featureLayer.call(this,t,this.options)}}),EMap.Layers.FeatureLayer.lineString=function(t,e){return new EMap.Layers.FeatureLayer.LineString(e).getFeatureGroup(t)}}(),function(){EMap.Layers.FeatureLayer.Polygon=EMap.Layers.FeatureLayer.extend({initialize:function(t){t=t||{},L.Util.setOptions(this,t),EMap.Layers.FeatureLayer.prototype.initialize.call(this,this.options),this.featureType=EMap.Utils.PolygonType},getFeatureGroup:function(t){return EMap.Layers.FeatureLayer.prototype._featureLayer.call(this,t,this.options)}}),EMap.Layers.FeatureLayer.polygon=function(t,e){return new EMap.Layers.FeatureLayer.Polygon(e).getFeatureGroup(t)}}(),function(){EMap.Layers.serviceLayer=function(){function t(t,e){var i,n=t.localMapServer,a=t.bounds||L.latLngBounds(L.latLng(-90,-180),L.latLng(90,180));switch(t.crs_name){case"EPSG4490":switch(t.layer){case"vec_d":i=L.tileLayer.tdt({name:"底图",layer:"vec",localMapServer:n,bounds:a});break;case"vec_z":i=L.tileLayer.tdt({name:"注记",layer:"cva",localMapServer:n,bounds:a});break;case"img_d":i=L.tileLayer.tdt({name:"底图",layer:"img",localMapServer:n,bounds:a});break;case"imd_z":i=L.tileLayer.tdt({name:"注记",layer:"cia",localMapServer:n,bounds:a});break;case"vec":var o=L.tileLayer.tdt({name:"底图",layer:"vec",localMapServer:n,bounds:a}),r=L.tileLayer.tdt({name:"注记",layer:"cva",localMapServer:n,bounds:a});e&&(o.setFilter(e),r.setFilter(e)),i=L.layerGroup([o,r]);break;case"img":i=L.layerGroup([L.tileLayer.tdt({name:"底图",layer:"img",localMapServer:n,bounds:a}),L.tileLayer.tdt({name:"注记",layer:"cia",localMapServer:n,bounds:a})])}}return i}return{createLayer:function(e,i){var n,a,o=i.layerTheme;if(o){var r=L.ImageFilters.Presets.CSS[o],s=L.ImageFilters.Presets.CanvasChannel.None;a=function(t,e){return new L.CombinedFilter({cssFilter:r,canvasFilter:s}).render(this,t,e)}}switch(e){case"wmts":n=L.tileLayer.wmts(i.url,i);break;case"tile":n=L.tileLayer(i.url,i),a&&n.setFilter(a);break;case"tdt":n=t(i,a);break;case"image":n=L.imageOverlay(i.url,i.bounds)}return n}}}()}();